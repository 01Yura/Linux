shift + ctrl + 6 - если ввел не то и начался поиск доменного имени


Пинг с компа 192.168.1.1 на комп 192.168.1.2 через новый свич, при пустых ARP таблицах на компах и пустой mac-table на свиче

- ПК1 планирует отослать пинг, зная то что адрес назначения в его сети (если не в своей сети, то он отправил бы его на мак дефолт гейтвея), когда пакет с 3г уровня спускается на второй, то комп проверяет соответствие Ip адреса и мак адреса в своей ARP таблице, но не находит соответствия, поэтому в действие вступает ARP протокол. Он буферизирует этот первый ICMP пакет, и отправляет броадкаст ARP запрос в сеть (кто с таким ip адресом, скажи свой mac). Этот ARP пакет уходит на свич. 
- Свич получает пакет, и добавляет мак адрес источника в свою mac таблицу (соответсвие мака и порта), и  рассылает полученный ARP кадр на все порты. 
- ПК2 получает кадр и добавляет данные в свою ARP таблицу и отправляет ARP ответ
- свич просто форвардит этот кадр на порт за которым находится ПК1, добавляя мак ПК2 в свою мак-таблицу
- кадр доходит до ПК1, он добавляет ip адрес ПК2 в свою ARP таблицу, ICMP пакет достается из буфера и уже имея соответсвие mac - ip в ARP таблице, формирует кадр и отправляет его на мак ПК2
- ПК2 получает кадр, декапсулирует его, видит что это пинг и отвечает на пинг

router> - user EXEC exec mode (router - its devise name) (in this mode you cant do any changes to config)

enable
router# - privileged EXEC mode (PEM)

? - to view available commands

configure terminal - global configuration mode (GCM)
router(config)
enable password CCNA - to protect priv EXEC mode with a password CCNA
Если заданы обе команды и enable password и enable secret, то password будет игнорироваться

running config - active config
startup config - конфиг при загрузке
show running-config - показать текущую конфигурация (PEM)
show startup-config

write / write memory / copy running-config startup-config - сохранить конфиг

service password-encryption

enable secret Cisco - второй метод это использование секрета
Если заданы обе команды и enable password и enable secret, то password будет игнорироваться

router(config)# do show run - частица do позвляет выполнить команду PEM в режиме GCM 

no команда - отмена команды

show mac address-table
clear mac address-table dynamic


        Назанчение ip адреса интерфейсу

show ip interface brief
По умолчанию на роутерах интерфейсы отключены

interface GigabitEthernet 0/0 - войти в режим конфигурации интерфейсов (in g0/0)
ip address 192.168.0.1 225.255.255.0
no shutdown

show interfaces status - данная команда работает только на свичах

show interfaces - показать инфу и ошибки всех интерфейсов

show interfaces g0/0 - инфа о интерфейсе и ошибки
show interfaces description
description ## to SW1 ## - чтобы внести свое описание для интерфейса

Если вы в режиме (config-if), то чтобы выйти в PEM можно не нажимать дважды exit, а один раз нажать end 

в режиме (config-if) нажать speed и выбрать скорость
speed
duplex

interface range f0/5 - 12

ping 192.168.1.1 size 10000 - указать размер пакета
ping 192.168.1.1 size 10000 df-bit - указать что нельзя фрагментировать

                Routing

show ip route
ip route адрес маска некст-хоп - чтобы задать маршрут
ip route адрес маска g0/0 - чтобы звдвть маршрут через интерфейс
или
ip route адрес маска g0/0 некст-хоп
ip route 0.0.0.0 0.0.0.0 некст-хоп - для default gateway

mac-address МАК - указать свой мак на интерфейс

                CIDR

Безклассовая адресация. Мы не используем устаревший способ деления всего адресного пространства IP4 на сети 5 классов, а делаем эти классы сами.
Это назвется subnetting

2n-2, где n-кол-во бит отведенное под хост - сколько хостов в сети
2n, где n-кол-во бит занятое дополнительно после точки под сеть - сколько возможно создать сетей


/25     2сети   126хостов
/26     4       62
/27     8       30
/28     16      14
/29     32      6
/30     64      2
/31     128     0(2)
/32     256     0(1)


FLSM - когда делишь сеть на одинакового размера сети (fix lenght)
VLSM - veriable lenght , когда делишь на неодинаковые подсети, начинать надо с большей обязательно

                        VLAN

show vlan brief
interface range g0/1 - 3
switchport mode access - по идее они и так уже являются access портами, но лучше указать это явно еще раз
switchport access vlan10
Эти команды сразу и создадут ыиланы тоже, даже если их нет 

Но чтобы создать вилан:
vlan 10
name ИМЯ_ВИЛАНА

        ТРАНК

НА СВИЧЕ:
int g0/0
switchport trunk encapsulation dot1q - данную команду надо ввожить на свичах поддерживающих устаревший ISL (проприетарный протокол), такм образом мы говорим в каком режиме рабоать транку
switchport mode trunk
show interfaces trunk - посмотреть инфу о транке
Кадры, которым разрешено ходить через интерфейс указан в том числе в графе 
Vlans allowed and active in management domain

switchport trunk allowed vlan ? - указываем кадры каких вланов будут ходить через этот интерфейс
Если на другой стороне кабеля есть влан с которым мы будем напрямую (без роутера) связываться (то есть у нас такой же вилан), то надо указать на нашей стороне интерфейса это влан, чтобы кадр придя от нас с нашим номером влана смог пройти через этот интерфейс

switchport trunk native vlan номер_влана - надо менять с дефолтного для безопасности ??? (1001)

НА РОУТЕРЕ:
включить основной интерфейс g0/0
interface g0/0.10
encapsulation dot1q 10(номер влана) - привязываем сабинтерфейс к влану
ip address адрес маска
sh ip int br 

Настройка Native vlan на роутере: (необязательно)
На всех транк интерфейсах свичей native vlan должен быть одинаковый (switchport trunk native vlan 10)

1) При настройки сабинтерфейса пометить 10 влан как нейтив
   int g0/0.10
   encapsulation dot1q 10 native
   ip add адрес маска

2) Удалить сабинтерФЕЙС ЕСЛИ ОН БЫЛ и выплнить команду
   int g0/0
   ip address адрес маска


Multilayer switch

НА РОУТЕРЕ:
- удалить все виртуальные интерфейсы 
no interface g0/0.10 и тогда
- default interface g0/0 - восстановить настройки по умолчанию
- sh ip int br (удаленные сабинтерфейсы остануться в выводе пока мы не перезагрузим роутер)
int g0/0
ip add 192.168.1.194 255.255.255.252 (маска 32) - 

НА СВИЧЕ:
default int g0/1
ip routing - включаем роутинг на свиче
no switchport - меняет принцип работы порта с 2 уровня на 3й
ip add 192.168.1.193 255.255.255.252
sh ip int br

ip route 0.0.0.0 0.0.0.0 192.168.1.194
sh ip route
sh int status (в колонке влан порт будет routed)

int vlan10 - создаем вирт интерфейс (SVI) для каждого из виланов
ip address 192.168.1.62 255.255.255.192
no shutdown

                DTP (dynamic tunking protocol)

Позволяет автоматически синхронизироыать смотрящие друг на друга порты свича CISCO, или access или trunk
show interfaces g0/0 switchport - показывет в каком режиме настроен порт
switchport nonegotiate - порт перестает отправляь DTP кадры
Перевод порта в access mode выключает DTP, но перевод порта в trunk mode - нет. 
По умолчанию транки на cisco имеют режим:
switchport trunk encapsulation negotiate 
поэтому прежде чем включить режим транк на порту, надо принудительно указать режим работы dot1q, иначе включится режим ISL, так как он в цисках имеет приоритетный выбор

DTP в целях безопасности надо откоючать и устанавливать все руками
switchport mode dynamic AUTO/DESIRABLE - это как раз и есть DTP. Desirable устанавливает транк или access с любым, прибитsv гвоздями, auto - только если второй приьит гвоздями, два auto смотрящих друг на друга - access

На старых свичах по умолчанию порты в режиме (administrative mode):
switchport mode dynamic desirable
На новых:
switchport mode dynamic auto

switchport nonegotiate - отключить DTP на конкретном порту



                VTP (VLAN trunking protocol)

Свич сервер рассылает кадры VTP по транк портвм, синхронизируя вланы на всех свичах сети, которые в режиме сервер или клиент, но не в прозрачном режиме (только передача кадров VTP)
Они смотрят значение номера ревизии, и если он больше текущего, то обновляют свою таблицу вланов

show vtp status - показывает используемую версию, домнное имя, ревизию изменений вланов, кол-во вланов и режим работы свича (сервер, клиент, прозрачный)
По умолчанию свичи находятся в режиме server
Чтобы VTP работал обязательно надо указать доменное имя VTP
VTP версий 1 и 2 не поддерживают расширенный диапазон VLAN

vtp domain имя - установть доменное имя
Если свич вне домена получает VTP кадр, то он устанавливает себе имя домена и обновляет VLAN таблицу, если ревизия выше чем его

Опвсность!!: если к существующей сети подключить какой то старый свич с ревизией выше, то он затрет все VLANы у свичей и будет проблема

vtp mode server/client/transparent
В клиентсокм режиме нельзя создавать/удалять VLANы
ЧТобы сбросить ревизию надо изменить на неиспользуемый домен, или вклчить прозрачный режим

vtp version 2 - сменить режим VTP (VTP 2 поддерживает token ring  можно его не использовать)

                Spanning tree (STP) (протокол связующего дерева)

Как работает:
1) Сначала блокирует все порты и рассылает кадры BPDU
2) Определяет центральный свич (если свич получил BPDU с более меньшим bridge ID, то он сдает позицию и больше не является root bridgом). После схождения  (converge) топологии только root bridge рассылает BPDU, остальные только принимают
3) Определяет как с каждого свича лучше добраться до центрального и данный порт разблокируется, а если есть второй порт то он остается заблокированным

1) Как выбирается root коммутатор:
По наименьшему bridge ID (свич становится root bridge) - все порты на этом свиче разблокируются (состояние forwarding ports) (их роль - designated ports, это одна из ролей портов в STP)
Bridge ID состоит из 2х полей :
- bridge priority (16бит) - по умолч 32768 (можно менять на число 4096)
- mac address - если у всех свичей одинаковый bridge priority, то root bridge свич выбирается по наименьшему мак адресу (сравнивать цифры надо слева направо)

Порты к которым подсоединены конечные устройства тоже разблокируются и не участвуют в передачи кадров BPDU (Bridge PDU)

Если есть виланы, то root bridge свич выбирается для каждого влана и это могут быть разные свичи

 2) Далее каждый из не root свичей выбирает один порт, который называется root port и с которого наименьшая стоимоть пути (root path cost) до root bridgа
 Считать надо cost только исходящего интерфейса, не принимающего
 Каждый свич отсылает BPDU со значением cost своего интерфеса в сумме с costом всех исходящих интерфейсов через которые проходил кадр BPDU, отправленный root bridgом на противоположный интерфейс свича соседа. Таким образом сосед узнает стоимость пути через данный интерфейс 
 10 Mbps - 100
 100 Mbps - 19
 1Gbps - 4
 10Gbps - 2

Если свич соединен двумя линками с разными соседями с одинаковой стоимотью, то root портом становится порт соединенный с соcедом с наименьшим sender bridge ID (как считать bridge ID указано выше)
Если свич соединен с соседом двумя одинаковыми линками, то вибирается линк с соседом у которого порт с наименьшим sender port ID (priority number) (команда для просмотра этих номеров - show spanning-tree)

3) Разблокируется (designated) порт у свича с наименьшим cost до root bridga, если cost одинаковый, то на свиче с наименьшим bridge ID
Порт у оставшегося свича остается заблокированным (non-designated or blocking or alternate port)

show spanning-tree - общая инфа по spanning-tree
show spanning-tree detail - по каждому интерфейсу

Cостояния интерфейсов:

Blocking - не принимают и дропают сетевой трафик, но принимают BPDU. Не пересылают BPDU и NOT learn mac-addresses

Listening - в этом состоянии находятся root and designated ports.
15 cек, согласно forward delay
Не принимают трафик, просто получают и пересылают BPDU

Learning - состояние после Listening
15 сек 
Не принимают трафик, просто получают и пересылают BPDU
Но в этом состоянии порт LEARN mac-addresses!

Forwarding - работает нормально

Spanning tree timers

Hello - 2сек
Forward delay - 15+15сек=30
Max age - как долго свич ждет BPDU если он перестал их получать. После этого свич считает что сосед отвалился и перестраивается топология.

Версии
PVST - работает только с ISL инкапсуляцией
PVST+ - работает с 802.1q

Regular STP использует мак назанчения 0180.с200.0000
PVST+ - 01:00:0c:cc:cc:cd

STP Toolkit

Portfast - включается на порту соединенному c хостом
Позволяет портам немедленно перейти в режим forwarding, минуя Listening and Learning
spanning-tree portfast
spanning-tree portfast default - вклбючает портфаст на всех access портах

BPDU Guard - включенный режим на порту похволяет автоматически отключить интерфейс, при получении BPDU кадра на этот порт
spanning-tree bpduguard enable - надо выполнять в настройках интерфейса
spanning-tree portfast bpduguard default - включает BPDU guard на всех интерфейсах, где включен portfast

Root Guard - если интерефейс получил BPDU с superior (lower bridge ID), то он отклоняется и свич остается root bridgем
Интерфейс отключается

Loop guard - даже если интерфейс перестал получать BPDU, то он остается выключенным

spanning-tree mode mst/pvst/rapid-pvst

spanning-tree vlan 1 root primary - установить свич рутом
spanning-tree vlan 1 root secondary

spanning-tree vlan1 cost/port-priority



