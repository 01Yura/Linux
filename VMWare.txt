        Конвертация хоста с VMWare в PnetLab
        https://www.eve-ng.net/index.php/faq/
        https://www.youtube.com/watch?v=_1gVzM4SnYo&t=190s

Копируем файл диска в папку /opt/unetlab/addons/qemu/название_папки
cd /opt/unetlab/addons/qemu/папка_с_файлом 
qemu-img convert -f vmdk -O qcow2 файл_с_vmware.vmdk hda.qcow2
После этого по идее надо сделать fixpermission
/opt/unetlab/wrappers/unl_wrapper -a fixpermissions

Образ с ключами: 
https://downloaddevtools.com/en/product/18/free-download-vmware-vsphere


        Проблемы с nested virtualization workstation product
Если у вас проблемы с вложенной виртуализацией на VMWare и появляется сообщение об ошибке "VMware Workstation does not support nested virtualization on this host. Module 'HV' power on failed"
 
Исправить её можно выполнив действия ниже:
 
Убедитесь, что безопасность на основе виртуализации (VBS) включена/не включена:
 
1. Откройте msinfo32 (системную информацию в Windows 10).
2. В разделе «Сводка системы» на правой странице прокрутите вниз до «Безопасность на основе виртуализации» и
убедитесь, что для параметра «Значение» установлено значение «Не включено».
3. Если установлено значение «включено», выполните шаги, указанные ниже, в соответствии с отключением Hyper-V.
 
Отключите Hyper-V
Перейдите к пункту «Включение или отключение компонентов Windows».
Убедитесь, что Hyper-v не отмечен галочкой.
Если он отмечен, снимите его и нажмите «ОК».
 
Откройте окно командной строки от имени администратора.
Запустите «bcdedit /enum »
 
Запишите тип запуска гипервизора на случай, если его нужно отменить.
Запустите «bcdedit /set hypervisorlaunchtype off», чтобы отключить гипервизор .
Закройте командную строку после выполнения команд и перезапустите систему.
Также необходимо сделать это: «убедитесь, что целостность памяти отключена.
Безопасность Windows -> Безопасность устройства -> Детали изоляции ядра»

ESXi хосты - реальные сервера на которые устанавливается ESXi (bare-metal virtualization)

Storage - на каждом физ сервере есть локальный жесткий диск 
Можно использовать сетевое хранилище и все физические сервера будут подключаться к нему по технологии ISCSI (internet скази) или по NFS, или по Fiber Channel или по FB over Ethetnet

vCenter - централизованный сервер для управления хостами (физическими). Он может быть физичеким или виртуальным. Это по сути программа, которая устанавливается на WinServer.
VCSA - это линукс версия vCenter устанавливаемая только виртуально (имеет ОС Photon OS, PostgreSQL DB и Platform Services Controller и vCenter Server)

Сеть 
Managment - та сеть через которую мы связываемся с хостами, то есть наша обычная сеть организации 192.168.0.1
Storage - вторая NIC хоста связана по этой отдельной сети с сетевым хранилищем (storage)
vMotion - сеть для миграции виртуалки с одного хоста на другой
VMnetwork - сеть внутри VMWare

В идеале иметь 5 железных серверов: AD, 3 шт bare-metal VMware ESXi , vCenter (установлен на машине с WinServer)

В Hyper-V создаем 5 хостов, и меняем тип адаптера на legasy, так как ESXi 6 не поддерживает совр адаптеры для nested virtualization
Во всех хостах уменьшаем максимальную динамическую память до максимальной для хоста (4096), а для vCenter (9000 - не динамическая!)
Для ESXi ставим 2 ядра, 4 legasy адаптера


Далее создаем свич
External - это bridge
Internal - мой комп и хосты видят друг друга, но выхода в интренет у хостов нет
Private - изолированная сеть для самих машин
Создаем external and private switches
В настроках каждой виртуалки подключаем их к private switch 

Устанавливаем winserver (192.168.1.3) и делаем его контроллером домена и DHCP сервером (192.168.0.100-254)
Установить статические адреса машинам ESXi и дать имена хостов
Создать А-записи для хостов ESXi в DNS контроллера домена



    ESXI 8 vSphere 8 Enterprise Plus

    HG00K-03H8K-48929-8K1NP-3LUJ4 
    4F40H-4ML1K-M89U0-0C2N4-1AKL4

    vCenter Server 8 Standard

    0F41K-0MJ4H-M88U1-0C3N0-0A214

Решение проблемы No healthy upstream vCenter
скачать ssh клмент, подключится и ввести команду, выбрать 8 и сделать новые сертификаты
    https://kb.vmware.com/s/article/2112283

свич

vmnic0 - это первый из 4х адаптеров нашего виртуального хоста ESXi
Он на схеме изображен справа

К этому vmnic0 подключены и Managment Network (на которой и висит ip ESXi) и VM Network (сеть виртуальных машин). Они все в одном широковещат домене и им назначаются IP адреса одной сети.